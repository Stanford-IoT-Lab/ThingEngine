drop table if exists feeds;
drop table if exists accounts;
drop table if exists identity_hashes;
drop table if exists blobs;
drop table if exists messages;
drop table if exists feed_objects;

create table feeds (
       id integer primary key,
       identifier text not null unique,
       name text not null default '',
       specifiedName text default null,
       specifiedThumbnailHash text default null,
       renderableTime integer not null default 0,
       messageCount integer not null default 0,
       _syncMask integer not null default 31,
       newestFromService integer not null default 0,
);

create table feed_member (
       feedId integer not null,
       accountId integer not null,
       primary key (feedId, accountId)
);

create table feed_invitation (
       feedId integer not null,
       identityHash text not null
       primary key (feedId, identityHash)
);

create table accounts (
       id integer primary key,
       account text not null unique,
       name text not null default '',
       thumbnailHash text default null,
       hasAppTime integer default null,
       profileVersion integer not null default 0,
       owned boolean not null default false,
       upToDate boolean not null default false
);

create table identity_hashes (
       identityHash text primary key,
       accountId integer not null
);

create table blobs (
       hash text not null,
       source text not null
);

create index blob_hash on blobs(hash);

create table messages (
       message_key text primary key,
       type text not null
);

create table feed_objects (
       feedId integer not null,
       msgId integer not null,
       aggregateLikeCount integer not null default 0,
       aggregateSelfLikeCount integer not null default 0,
       likeCount integer not null default 0,
       selfLikeCount integer not null default 0,
       profileVersion integer not null,
       senderId integer not null,
       serverTimestamp integer not null,
       ourTimestamp integer not null,
       msgType varchar not null,
       msgExtra varchar not null default '{}',
       primary key (feedId, msgId)
);

create table feed_objects_like (
       feedId integer not null,
       msgId integer not null,
       like_type text not null,
       accountId integer not null,
       primary key (feedId, msgId, like_type, accountId)
);

